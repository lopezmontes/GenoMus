\documentclass{article}


\usepackage{arxiv}

\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts
\usepackage{hyperref}       % hyperlinks
\usepackage{url}            % simple URL typesetting
\usepackage{booktabs}       % professional-quality tables
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{nicefrac}       % compact symbols for 1/2, etc.
\usepackage{microtype}      % microtypography
\usepackage{lipsum}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{graphicx}

\definecolor{backcolour}{rgb}{0.96,0.96,0.96}
\definecolor{forcomments}{rgb}{0.5,0.5,0.5}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
 
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{forcomments},
    numberstyle=\tiny\color{codegray},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2
}
 
\lstset{style=mystyle}


\renewcommand{\vec}[1]{\mathbf{#1}}

\title{GenoMus: Representing procedural musical structures with an encoded functional grammar optimized for metaprogramming and machine learning}


\author{
  Jos\'e L\'opez-Montes\thanks{\url{https://www.lopezmontes.es}} \\
  University of Granada\\
  \texttt{lopezmontes@correo.ugr.es} \\
  %% examples of more authors
%   \And
% Elias D.~Striatum \\
%  Department of Electrical Engineering\\
%  Mount-Sheikh University\\
%  Santa Narimana, Levand \\
%  \texttt{stariate@ee.mount-sheikh.edu} \\
  %% \AND
  %% Coauthor \\
  %% Affiliation \\
  %% Address \\
  %% \texttt{email} \\
  %% \And
  %% Coauthor \\
  %% Affiliation \\
  %% Address \\
  %% \texttt{email} \\
  %% \And
  %% Coauthor \\
  %% Affiliation \\
  %% Address \\
  %% \texttt{email} \\
}

\begin{document}
\maketitle

\begin{abstract}

 	
We present GenoMus, a new model for artificial musical creativity based on a procedural approach, able to represent and learn the compositional techniques behind a musical score. The aim of this model is to build a framework for automatic creativity, easily adaptable to other domains beyond music. The core of GenoMus is a functional grammar designed to cover a wide range of styles, integrating traditional and contemporary composing techniques. Musical \emph{genotypes} are defined as functional trees, able to generate musical scores described as \emph{phenotypes}. To enable the maximal diversity of outputs, each process uses the same generic functional structure, no matter what time scale, polyphonic structure or additional characteristics are being employed. The goal of this highly homogeneous and modular approach is to simplify metaprogramming of genotypes, as well as maximize search space. Genotypes and phenotypes are encoded as normalized numeric vectors. This abstract representation of musical knowledge as pure numeric arrays is convenient for the application of different machine learning paradigms. The user interface developed for GenoMus is oriented to the exploration of augmented creativity, regardless of user expertise. However, a composer can create and alter manually genotypes and algorithms to modify automatic results. The system allows the implementation of user-defined processes, which will expand the procedures library. 

\end{abstract}


% keywords can be removed
\keywords{automatic musical composition \and metaprogramming \and procedural representation of music \and artificial creativity \and GenoMus }


\setcounter{tocdepth}{2}
\tableofcontents
\bigskip

\section{Introduction}
\subsection{Composing composers}

Research in artificial musical intelligence demand for formalized
grammars of musical structures. Besides, a model of creative
mind is required to operate these abstractions.
Aesthetic criteria are extremely subjective, furthermore the details
of every model of automatic composition impose, consciously
or not, a limited search space. Delimiting these
boundaries and setting evaluation principles can be seen as
metacomposition, namely composing composers.

Composers' interest in musical language pervaded the 20th
century aesthetics. Transformation and overcoming of well-established methods
inherited from Romanticism led to post-tonal
music. Linguistic structuralism applied to musical
syntax stimulated relativization and consciousness of
compositional procedures. Reversing the logic of this analytic knowledge, the methods
of serial dodecaphonic music was the first step for the foundations of
an inverse creative strategy: synthesize new styles from the predefinition of new rules. 

Computer assisted composition enabled
far more complex procedures, tedious or unfeasible to explore by hand. Eventually, composers began to use computers not only for analysis and calculation of complex structures, but for the automation of the creative processes themselves. That fact opened the door to a new approach to composition: a metamusical level characterized by modeling the processes within the minds of composers. 

{\color{gray} \textsl{[Reflexiones sobre metacomposicion, el concepto de autoria y consideraciones pedagogicas y humanas de fondo.]}}


{\color{gray} \textsl{[Interes de la musica en el modelado de creatividad artificial - multidimensionalidad de la percepcion y analisis]}}

{\color{gray} \textsl{[Sobre la necesidad de usar el metanivel de los procedimientos antes que la partitura]}}

Many approaches to artificial intelligence applied to the automatic composition of music are modeled using scores as its data source...

{\color{gray} \textsl{[Complejidad del diseno de lenguajes de representacion musical en la composicion asistida por ordenador. Cita de algunas aproximaciones analogas.]}}

\subsection{The next step of computer assisted composition}
{\color{gray} \textsl{[Repaso rapido de los principales paradigmas de herramientas de CAC para hacer notar como es necesario un metanivel de trabajo]}}

This proposal, beyond the technical details, is a model of augmented creativity from the point of view of the composer. The new paradigm of computation applied to creative tasks is tilting from ordering to the computer "what to do", to saying "what to get", as a starting point to detonate supervised or non-supervised creative processes. So, the goal of GenoMus is to combine a knowledge base of compositional procedures with the maximal freedom of recombination. 

\subsection{Complementary materials to this text}



%------------------------------------------------


\section{A functional grammar to represent musical procedures}

\subsection{Foundations and requirements}

In any approach to artificial creativity, the representation system used is a condition that restricts the search space and determines aesthetic biases a priori, either consciously or unconsciously. On the other hand, the design of algorithms to generate music is ultimately an act of composition. With this in mind, our proposal seeks to be as open as possible, so that it can represent multiple styles. However, since the purpose of the project is not to imitate styles, but to create results of great originality and also serve as a tool for the \emph{augmented creativity} of human composers, this grammar integrates contemporary compositional techniques such as recursive processes, controlled randomness, self-similarity, etc.

A system expressive!!

{\color{gray} \textsl{[]}}

{\color{gray} \textsl{[Conveniencia del paradigma de programacion funcional para la metaprogramacion. Antecedentes procedimientos compositivos como funciones (referencias a Haskell y LISP en la tradicion)]}}

{\color{gray} \textsl{[Necesidad de encontrar un medio de representacion adecuado a la automatizacion de analisis, a la flexibilidad de estilos, y a conjugar la programacion manual con la modularidad necesaria para las tareas automatizadas]}}

{\color{gray} \textsl{[Importancia de la codificacion como vector numerico como representacion abstracta de estructuras y resultados musicales para la aplicacion de tecnicas de IA.]}}


\subsection{Musical genotypes and phenotypes}

{\color{gray} \textsl{[Marco conceptual basico del paradigma genotipo-fenotipo (referencias de otros proyectos)]}}

{\color{gray} \textsl{[Definiciones estrictas de genotipo y fenotipo]}}


{\color{gray} \textsl{[Similitud con la programacion funcional: la pieza musical como funcion de funciones.]}}

\subsection{Species and specimens}

\subsection{Anatomy of a genotype function}

\subsection{Function types}

{\color{gray} \textsl{[Tabla con los tipos de funciones. Figura ilustrando la estructura score/voice/chord]}}

\subsection{Leaves, parameter mapping and readability}

\subsection{Function libraries}

\subsection{Specimen data structure}


{\color{gray} \textsl{[Tabla con la estructura de datos de cada par geno\/feno generado]}}



%------------------------------------------------


\section{Encoded genotypes and phenotypes}

\begin{itemize}
\item Proposito de la codificacion en el marco del machine learning
\item Codificacion como vectores unidimensionales normalizados
\item Universal valid format
\item Modularidad y posibilidad de manipulacion manual
\item Encoding as safety filter

\end{itemize}
\subsection{Encoding genotypes with G{\"o}delian resonances}

Any random sequence of numbers generates a valid program. 

$$ P = \{x_n \in \mathbb{R} \: | \: 0 \leq x_n \leq1 \} $$
Multidimensional search space of all possible vectors with normalized parameters:
$$ P^n $$
Each vector in P is mapped to a valid encoded genotype (that is a valid functional expression which generates an excerpt of music.
Let G be the set of all possible valid encoded genotypes. To create genotypes, the map $f$ works as a decision tree such as every vector $\vec{p} = (p_1, p_2, ..., p_n) \in P^n$ will be mapped to $G$: 
$$f:\ P^n\to G$$
Most of times $n$ doesn't match the number of required items to complete a valid encoded genotype. If $\vec{p}$ has more items than needed, they are ignored. If $f$ needs more items than those supplied by $\vec{p}$, $f$ reads $\vec{p}$ repeatedly from the beginning as a loop, until closing the valid encoded genotype. That implies that even vectors with a single value can be mapped to large functional expressions.  



\subsection{Scores represented as normalized vectors}
\subsection{A unique format for procedures and results}
\subsection{Safety through encoding}








%------------------------------------------------

\section{A minimal example: \textsl{Clapping music}}

Presentacion de la pieza


\begin{figure}
  \includegraphics[width=\linewidth]{figs/clapping_patterns.pdf}
  \caption{Structures of S. Reich's \emph{Clapping Music}.}
  \label{fig:boat1}
\end{figure}

Figure \ref{fig:boat1} shows a boat.

\subsection{Code and interface for the experiments}
[manual coding to extract procedural and extendable knowledge]\cite{Hofmann2015} 

\subsection{Decoded genotype: a procedural function tree of the piece}


\begin{lstlisting}[language=Java, caption=A possible decoded genotype for S. Reich's \emph{Clapping Music}]
s2V(                           // score L: joins the 2 voices vertically
  vSlice(                      // voice J: slices last cycle because of phase lag
    vRepeatV(                  // phase G: F 13 times
      vRepeatV(                // cycle F: E 8 times 
        vConcatV(              // pattern E: C + D
          vConcatV(            // motif C: A + B
            vMotifLoop(        // core motif A: 3 8th-notes and a silence
              ln(1/8),         // note values
              lm(65),          // pitch (irrelevant for this piece)
              la(50),          // articulation
              li(60,60,90,0)), // intensities (last note louder for clarity) 
            vSlice(            // motif B: A with 1st note sliced
              vAutoref(0),
              q(1))),
          vSlice(              // motif D: C with 1st note sliced
            vAutoref(3),
            q(2))),
        q(8)),
      q(13)),
    q(8)),
  vConcatV(                    // voice K: F + H
    vAutoref(7),
    vRepeatV(                  // phase I: H 12 times 
      vSlice(                  // cycle H: cycle F with 1st note sliced
        vAutoref(10),
        q(1)),
      q(12))))
\end{lstlisting}


\begin{figure}
  \includegraphics[width=\linewidth]{figs/clapping_tree_graph_colours_code.pdf}
  \caption{Structures of S. Reich's \emph{Clapping Music}.}
  \label{fig:boat2}
\end{figure}

Figure \ref{fig:boat2} shows a boat.


\begin{figure}
\begin{center}
  \includegraphics[width=13cm]{figs/clappingVisualized.pdf}
\end{center}  
  \caption{Structures of S. Reich's \emph{Clapping Music}.}
  \label{fig:boat3}
\end{figure}

Figure \ref{fig:boat3} Visualization of the encoded genotype of \emph{Clapping Music}.



Extrapolacion de estructuras y variantes:

{\small \begin{verbatim}ClappingMusic ([.04,.04,.08],[65],[.5],[50,50,120],1,3,2,8,13,8,1,12) =\end{verbatim}}  


\subsection{Encoded genotype: an abstract representation of compositional processes}

\begin{lstlisting}[language=Java, caption=Encoded genotype for S. Reich's \emph{Clapping Music}]
[1, 0.275535, 1, 0.534808, 1, 0.665631, 1, 0.665631, 1, 0.575462, 1, 0.575462, 1, 0.606798, 1, 0.27051, 0.51, 0.5, 0, 1, 0.506578, 0.53, 0.53, 0, 1, 0.742646, 0.55, 0.51346, 0, 1, 0.36068, 0.56, 0.6, 0.56, 0.6, 0.56, 0.9, 0.56, 0, 0, 0, 1, 0.534808, 1, 0.304952, 0.57, 0, 0, 1, 0.416408, 0.58, 0.55, 0, 0, 0, 1, 0.534808, 1, 0.304952, 0.57, 0.854102, 0, 1, 0.416408, 0.58, 0.6, 0, 0, 0, 1, 0.416408, 0.58, 0.75, 0, 0, 1, 0.416408, 0.58, 0.84, 0, 0, 1, 0.416408, 0.58, 0.75, 0, 0, 1, 0.575462, 1, 0.304952, 0.57, 0.326238, 0, 1, 0.665631, 1, 0.534808, 1, 0.304952, 0.57, 0.18034, 0, 1, 0.416408, 0.58, 0.55, 0, 0, 1, 0.416408, 0.58, 0.82, 0, 0, 0, 0]
\end{lstlisting}

Visualization?

\subsection{Encoded phenotype and possible outputs}



\begin{itemize}

\item Un ejemplo clasico con varias voces y conteniendo armonia, dinamica y articulacion
\item Modularidad y posibilidad de manipulacion manual
\item Ejemplos basicos de tecnicas habituales en CAC (movimiento browniano,
\item Handling of recursive techniques (fibonacci, y extension del modelo a expresiones matematicas complejas)
\item Puentes entra la notacion tradicional, la sintesis de sonido y la espacializacion
\item Multimedia
\end{itemize}


%------------------------------------------------





%------------------------------------------------


\section{Evaluation and evolution}

When modeling artistic creativity with algorithms, probably the most evasive issue to address is programming fitness functions. By definition, the assessment of a piece of art can only be made from a subjective point of view, since the goal of art is to provoke inner and personal reactions. These individual responses are very dependent on cultural and social context. However, provided enough data some predictions can be made about the expected rating for a new piece.

In GenoMus, we divide evaluation of each specimen in two categories:

\begin{itemize}
\item Autoanalytic profile: objective analysis of a set of musical features, such as variability, rhythmic complelxity, tonal stability, global dissonance index, level of inner autoreference, etc. 
\item Human evaluations: subjective ratings made by human users, attending to aesthetic value, originality, mood and emotional intensity. This informations are stored individually and together as global statistics.

\end{itemize}

The self-analysis contained in every specimen allows to measure distance and similaritiy to  
other specimens, as well as to classify results and to drive evolution processes.

Defining how to evaluate and select results is now the most creative effort, and can be identified with the act of composition itself, since composing music is ultimately making choices. 


\begin{itemize}
\item Esta propuesta de gramatica posibilita la implementacion y competencia de diferentes sistemas de evaluacion
\item Design of evaluation methods as the crucial act of composition
\item Objective vs. subjective evaluation
\item What to learn?
\item Evolutionary paradigm as the most promising
\end{itemize}

\subsection{Evolutionary paradigm}

Determining how to evolve and mutate an specimen towards a best version is crucial question too. Starting from a simple motif, endless evolution paths can lead to satisfying results based on heuristic approaches, using accumulated knowledge from examples, human ratings and automatic self-analysis.

The GenoMus grammar is designed to favor the broadest diversity of combinations and transformations. Genetic algorithms are suitable for the automation of an incremental exploration and selection of multiple ways. A GenoMus decoded genotype tree expression can be trasnformed using these methods:

\begin{itemize}
\item createGen
\item mutateLeaves
\item growTrunk
\item growBranch
\item insertBranch
\item flattenBranch
\item pruneBranch
\item splitGen

\end{itemize}

Approaches based on neural networks need a very controlled format of data and big training datasets. The encoded genotype format of GenoMus can represent any piece of music as a simple unidimensional sequence of normalized floats, which can be profitable for techniques as recurrent neural networks (ref. to LMSTD), able to learn patterns from sequential streams of data.


\section{Scalability}
\begin{itemize}
\item Como conjugar universalidad de las expresiones con optimizacion para tener los vectores codificados con mayores diferencias entre si.
\item Estrategias de caracterizacion de perfiles estilisticos
\item El problema del mapeo de funciones y su extensibilidad
\item Como establecer una base de datos de conocimiento
\item Metricas automatizadas de ciertos resultados
\end{itemize}

\subsection{Integrating traditional and contemporary techniques}
%------------------------------------------------


\section{Conclusions and future work}

The artistic results of every algorithm designed for automated composition
are strongly constrained by their own representation
system of musical data. This paper presents GenoMus, a
framework for the exploration of artificial musical creativity
based on a generative grammar focused on the abstraction
of creative processes as a metalevel of compositional
tasks. We define musical genotypes as functional
nested expressions, and phenotypes as the pieces created
by evaluating these computable expressions. GenoMus' grammar is designed 
to ease the combination of fundamental procedures behind very different styles, ranging from basic to complex contemporary
techniques, particularly those able to produce rich
output from very simple recursive algorithms. At the same
time, maximal modularity is provided to simplify metaprogramming
routines to generate, assess, transform and categorize
the selected musical excerpts. The system is conceived
to maintain a long term interrelation with different
users achieving individual musical styles. This proposed
grammar can also be an analytic tool, from the point of
view of composition as computation, considering that the
best analysis of a piece is the shortest precise description.

Cuestiones interesantes: 
\begin{itemize}
\item ?Cuantas funciones primitivas son necesarias para generar musica en un determinado estilo? Hay innumerables expresiones funcionales diferentes que pueden generar la misma musica. Se puede deducir que la expresion funcional mas breve es el mejor analisis. Se pueden ver diferentes paradigmas de ensenanza/aprendizaje de la musica con estos modelos.
\item ?Como puede hacerse ingenieria inversa automatizada para extraer estructuras desde la musica?
\end{itemize}

%\section{Headings: first level}
%\label{sec:headings}
%
%\lipsum[4] See Section \ref{sec:headings}.
%
%\subsection{Headings: second level}
%\lipsum[5]
%\begin{equation}
%\xi _{ij}(t)=P(x_{t}=i,x_{t+1}=j|y,v,w;\theta)= {\frac {\alpha _{i}(t)a^{w_t}_{ij}\beta _{j}(t+1)b^{v_{t+1}}_{j}(y_{t+1})}{\sum _{i=1}^{N} \sum _{j=1}^{N} \alpha _{i}(t)a^{w_t}_{ij}\beta _{j}(t+1)b^{v_{t+1}}_{j}(y_{t+1})}}
%\end{equation}
%
%\subsubsection{Headings: third level}
%\lipsum[6]
%
%\paragraph{Paragraph}
%\lipsum[7]
%
%\section{Examples of citations, figures, tables, references}
%\label{sec:others}
%\lipsum[8] \cite{kour2014real,kour2014fast} and see \cite{hadash2018estimate}.
%
%The documentation for \verb+natbib+ may be found at
%\begin{center}
%  \url{http://mirrors.ctan.org/macros/latex/contrib/natbib/natnotes.pdf}
%\end{center}
%Of note is the command \verb+\citet+, which produces citations
%appropriate for use in inline text.  For example,
%\begin{verbatim}
%   \citet{hasselmo} investigated\dots
%\end{verbatim}
%produces
%\begin{quote}
%  Hasselmo, et al.\ (1995) investigated\dots
%\end{quote}
%
%\begin{center}
%  \url{https://www.ctan.org/pkg/booktabs}
%\end{center}
%
%
%\subsection{Figures}
%\lipsum[10] 
%See Figure \ref{fig:fig1}. Here is how you add footnotes. \footnote{Sample of the first footnote.}
%\lipsum[11] 
%
%\begin{figure}
%  \centering
%  \fbox{\rule[-.5cm]{4cm}{4cm} \rule[-.5cm]{4cm}{0cm}}
%  \caption{Sample figure caption.}
%  \label{fig:fig1}
%\end{figure}
%
%\subsection{Tables}
%\lipsum[12]
%See awesome Table~\ref{tab:table}.
%
%\begin{table}
% \caption{Sample table title}
%  \centering
%  \begin{tabular}{lll}
%    \toprule
%    \multicolumn{2}{c}{Part}                   \\
%    \cmidrule(r){1-2}
%    Name     & Description     & Size ($\mu$m) \\
%    \midrule
%    Dendrite & Input terminal  & $\sim$100     \\
%    Axon     & Output terminal & $\sim$10      \\
%    Soma     & Cell body       & up to $10^6$  \\
%    \bottomrule
%  \end{tabular}
%  \label{tab:table}
%\end{table}
%
%\subsection{Lists}
%\begin{itemize}
%\item Lorem ipsum dolor sit amet
%\item consectetur adipiscing elit. 
%\item Aliquam dignissim blandit est, in dictum tortor gravida eget. In ac rutrum magna.
%\end{itemize}

Ejemplo de citas  \cite{compoCombiSimul,Schmidhuber95low-complexityart} y otra cita \cite{Lopez-Montes_TFM}.

\bibliographystyle{unsrt}  
\bibliography{references}  

\end{document}